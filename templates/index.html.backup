<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ² Yacht Game AI</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .game-container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .dice-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        h1 { 
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .dice-container { 
            display: flex; 
            justify-content: center; 
            gap: 25px; 
            margin: 30px 0;
            flex-wrap: wrap;
            perspective: 1000px;
        }
        .die-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        /* 3D ì£¼ì‚¬ìœ„ ìŠ¤íƒ€ì¼ */
        .die-3d {
            width: 80px;
            height: 80px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .die-3d.rolling {
            animation: roll3d 0.6s ease-out;
        }
        @keyframes roll3d {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            50% { transform: rotateX(360deg) rotateY(180deg); }
            100% { transform: rotateX(720deg) rotateY(360deg); }
        }
        .die-3d.kept {
            filter: drop-shadow(0 0 10px #ffd700);
        }
        .die-3d.ai-recommend-keep {
            filter: drop-shadow(0 0 15px #00ff00);
        }
        .die-3d.ai-recommend-reroll {
            filter: drop-shadow(0 0 15px #ff4444);
        }
        
        .die-face {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            border: 2px solid #ddd;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            padding: 8px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
        }
        .die-face.kept-face {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-color: #ff6b6b;
        }
        
        /* ì£¼ì‚¬ìœ„ ëˆˆ */
        .dot {
            width: 14px;
            height: 14px;
            background: #1a1a2e;
            border-radius: 50%;
            box-shadow: inset 0 2px 3px rgba(0,0,0,0.3);
        }
        .die-face.face-1 { transform: rotateY(0deg) translateZ(40px); }
        .die-face.face-2 { transform: rotateY(90deg) translateZ(40px); }
        .die-face.face-3 { transform: rotateY(180deg) translateZ(40px); }
        .die-face.face-4 { transform: rotateY(-90deg) translateZ(40px); }
        .die-face.face-5 { transform: rotateX(90deg) translateZ(40px); }
        .die-face.face-6 { transform: rotateX(-90deg) translateZ(40px); }
        
        /* ëˆˆ ë°°ì¹˜ */
        .die-face {
            display: grid;
            gap: 8px;
        }
        .die-face[data-value="1"] {
            grid-template: repeat(3, 1fr) / repeat(3, 1fr);
        }
        .die-face[data-value="1"] .dot { grid-area: 2 / 2; }
        
        .die-face[data-value="2"] {
            grid-template: repeat(2, 1fr) / repeat(2, 1fr);
        }
        .die-face[data-value="2"] .dot:nth-child(1) { grid-area: 1 / 1; }
        .die-face[data-value="2"] .dot:nth-child(2) { grid-area: 2 / 2; }
        
        .die-face[data-value="3"] {
            grid-template: repeat(3, 1fr) / repeat(3, 1fr);
        }
        .die-face[data-value="3"] .dot:nth-child(1) { grid-area: 1 / 1; }
        .die-face[data-value="3"] .dot:nth-child(2) { grid-area: 2 / 2; }
        .die-face[data-value="3"] .dot:nth-child(3) { grid-area: 3 / 3; }
        
        .die-face[data-value="4"] {
            grid-template: repeat(2, 1fr) / repeat(2, 1fr);
        }
        .die-face[data-value="4"] .dot { margin: auto; }
        
        .die-face[data-value="5"] {
            grid-template: repeat(3, 1fr) / repeat(3, 1fr);
        }
        .die-face[data-value="5"] .dot:nth-child(1) { grid-area: 1 / 1; }
        .die-face[data-value="5"] .dot:nth-child(2) { grid-area: 1 / 3; }
        .die-face[data-value="5"] .dot:nth-child(3) { grid-area: 2 / 2; }
        .die-face[data-value="5"] .dot:nth-child(4) { grid-area: 3 / 1; }
        .die-face[data-value="5"] .dot:nth-child(5) { grid-area: 3 / 3; }
        
        .die-face[data-value="6"] {
            grid-template: repeat(3, 1fr) / repeat(2, 1fr);
        }
        .die-face[data-value="6"] .dot { margin: auto; }
        
        .die-recommendation {
            font-size: 11px;
            color: #00ffcc;
            font-weight: bold;
            min-height: 20px;
        }
        .controls {
            text-align: center;
            margin-top: 20px;
        }
        .rolls-info {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #00ffcc;
        }
        .btn { 
            padding: 15px 40px; 
            font-size: 18px; 
            margin: 10px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        .btn:hover:not(:disabled) { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-reset {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .ai-panel {
            background: rgba(0, 255, 204, 0.1);
            border: 2px solid #00ffcc;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            min-height: 120px;
        }
        .ai-message { 
            color: #00ffcc; 
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        .ai-recommendations {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }
        .ai-rec-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        .scorecard {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 300px;
        }
        .scorecard h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #00ffcc;
        }
        .score-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .score-row:hover:not(.filled):not(.bonus-row) {
            background: rgba(102, 126, 234, 0.3);
            transform: translateX(5px);
        }
        .score-row.filled {
            background: rgba(0, 255, 204, 0.2);
            cursor: default;
        }
        .score-row.bonus-row {
            background: rgba(255, 215, 0, 0.2);
            cursor: default;
            font-weight: bold;
        }
        .score-label { font-weight: 500; }
        .score-value { 
            font-weight: bold;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .score-preview {
            font-size: 0.85em;
            color: #00ffcc;
            opacity: 0.8;
        }
        .total-row {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            font-size: 1.2em;
            font-weight: bold;
            color: #ffd700;
        }
        .reboot-btn { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: #ff4444; 
            color: white; 
            border: none; 
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);
            transition: all 0.3s ease;
        }
        .reboot-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 68, 68, 0.6);
        }
        @keyframes rollAnimation {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }
        .die.rolling {
            animation: rollAnimation 0.5s ease-in-out;
        }-3d" onclick="toggleKeep(0)" data-index="0" id="die-0"></div>
                    <div class="die-recommendation" id="rec-0"></div>
                </div>
                <div class="die-wrapper">
                    <div class="die-3d" onclick="toggleKeep(1)" data-index="1" id="die-1"></div>
                    <div class="die-recommendation" id="rec-1"></div>
                </div>
                <div class="die-wrapper">
                    <div class="die-3d" onclick="toggleKeep(2)" data-index="2" id="die-2"></div>
                    <div class="die-recommendation" id="rec-2"></div>
                </div>
                <div class="die-wrapper">
                    <div class="die-3d" onclick="toggleKeep(3)" data-index="3" id="die-3"></div>
                    <div class="die-recommendation" id="rec-3"></div>
                </div>
                <div class="die-wrapper">
                    <div class="die-3d" onclick="toggleKeep(4)" data-index="4" id="die-4">
                <div class="die-wrapper">
                    <div class="die" onclick="toggleKeep(2)" data-index="2">1</div>
                    <div class="die-recommendation" id="rec-2"></div>
                </div>
                <div class="die-wrapper">
                    <div class="die" onclick="toggleKeep(3)" data-index="3">1</div>
                    <div class="die-recommendation" id="rec-3"></div>
                </div>
                <div class="die-wrapper">
                    <div class="die" onclick="toggleKeep(4)" data-index="4">1</div>
                    <div class="die-recommendation" id="rec-4"></div>
                </div>
            </div>

            <div class="controls">
                <div class="rolls-info">ë‚¨ì€ êµ´ë¦¼: <span id="rolls-left">3</span>/3</div>
                <button class="btn" onclick="rollDice()" id="roll-btn">ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                <button class="btn btn-reset" onclick="resetGame()">ğŸ”„ ìƒˆ ê²Œì„</button>
            </div>

            <div class="ai-panel">
                <div class="ai-message" id="ai-message">ğŸ¤– ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!</div>
                <div class="ai-recommendations" id="ai-recs"></div>
            </div>
        </div>

        <div class="scorecard">
            <h2>ğŸ“Š ì ìˆ˜í‘œ</h2>
            <div id="scorecard"></div>
        </div>
    </div>

    <button class="reboot-btn" onclick="rebootSystem()">ğŸ”„ ì„œë²„ ì¬ë¶€íŒ…</button>

    <script>
        const CATEGORIES = [
            { id: 0, name: 'Ones (1)', key: 'ones' },
            { id: 1, name: 'Twos (2)', key: 'twos' },
            { id: 2, name: 'Threes (3)', key: 'threes' },
            { id: 3, name: 'Fours (4)', key: 'fours' },
            { id: 4, name: 'Fives (5)', key: 'fives' },
            { id: 5, name: 'Sixes (6)', key: 'sixes' },
            { id: 6, name: 'Choice', key: 'choice' },
            { id: 7, name: '4 of a Kind', key: '4kind' },
            { id: 8, name: 'Full House', key: 'fullhouse' },
            { id: 9, name: 'S. Straight', key: 'sstraight' },
            { id: 10, name: 'L. Straight', key: 'lstraight' },
            { id: 11, name: 'Yacht', key: 'yacht' }
        ];

        let dice = [1, 1, 1, 1, 1];
        let kept = [false, false, false, false, false];
        let rollsLeft = 3;
        let scorecard = Array(12).fill(null);
        let gameOver = false;
        let aiRecommendation = null;

        // ì£¼ì‚¬ìœ„ ëˆˆ ìƒì„± í•¨ìˆ˜
        function createDieFace(value, isKept = false) {
            const keptClass = isKept ? 'kept-face' : '';
            let dots = '';
            for (let i = 0; i < value; i++) {
                dots += '<div class="dot"></div>';
            }
            return `<div class="die-face ${keptClass}" data-value="${value}">${dots}</div>`;
        }

        // 3D ì£¼ì‚¬ìœ„ ìƒì„±
        function create3DDie(value, isKept = false) {
            const rotation = getDieRotation(value);
            const keptClass = isKept ? 'kept' : '';
            retuconst currentScore = calculateScore(dice, idx);
                const showPreview = scorecard[idx] === null && rollsLeft < 3;
                
                html += `<div class="score-row ${scorecard[idx] !== null ? 'filled' : ''}" 
                         onclick="selectCategory(${idx})" id="score-${idx}">
                    <span class="score-label">${cat.name}</span>
                    <span class="score-value">
                        ${scorecard[idx] !== null ? scorecard[idx] : '-'}
                        ${showPreview ? `<span class="score-preview">(${currentScore}ì )</span>` : ''}
                    
                    ${createDieFace(3, isKept)}
                    ${createDieFace(4, isKept)}
                    ${createDieFace(5, isKept)}
                    ${createDieFace(6, isKept)}
                </div>
            `;
        }

        // ì£¼ì‚¬ìœ„ íšŒì „ ê°ë„ ê³„ì‚°
        function getDieRotation(value) {
            const rotations = {
                1: 'rotateY(0deg) rotateX(0deg)',
                2: 'rotateY(-90deg) rotateX(0deg)',
                3: 'rotateY(180deg) rotateX(0deg)',
            for (let i = 0; i < 5; i++) {
                const dieEl = document.getElementById(`die-${i}`);
                const wrapper = dieEl.parentElement;
                
                // 3D ì£¼ì‚¬ìœ„ ì—…ë°ì´íŠ¸
                dieEl.outerHTML = create3DDie(dice[i], kept[i]);
                const newDie = document.getElementById(`die-${i}`);
                newDie.onclick = () => toggleKeep(i);
                newDie.setAttribute('data-index', i);
                newDie.id = `die-${i}`;
                
                // AI ì¶”ì²œ í´ë˜ìŠ¤ ì¶”ê°€
                if (aiRecommendation && aiRecommendation.dice_recommendations) {
                    const rec = aiRecommendation.dice_recommendations[i];
                    if (rec.action === 'keep') {
                        newDie.classList.add('ai-recommend-keep');
                    } else {
                        newDie.classList.add('ai-recommend-reroll');
                    }
                }
            }     html += `<div class="score-row bonus-row">
                        <span class="score-label">Upper Bonus (63+)</span>
                        <span class="score-value">+${bonus}</span>
                    </div>`;
                }
                
                html += `<div class="score-row ${scorecard[idx] !== null ? 'filled' : ''}" 
                         onclick="selectCategory(${idx})" id="score-${idx}">
                    <span class="score-label">${cat.name}</span>
                    <span class="score-value">${scorecard[idx] !== null ? scorecard[idx] : '-'}</span>
                </div>`;
            });
            
            const total = calculateTotal();
            html += `<div class="score-row total-row">
                <span class="score-label">TOTAL</span>
                <span class="score-value">${total}</span>
            </div>`;
            
            scorecardEl.innerHTML = html;
        }

        function calculateTotal() {
            const upperSum = scorecard.slice(0, 6).reduce((sum, val) => sum + (val || 0), 0);
            const bonus = upperSum >= 63 ? 35 : 0;
            const lowerSum = scorecard.slice(6).reduce((sum, val) => sum + (val || 0), 0);
            return upperSum + bonus + lowerSum;
        }

        function updateDiceUI() {
            const dies = document.querySelectorAll('.die');
            dies.forEach((el, i) => {
                el.innerText = dice[i];
                el.className = 'die';
                if (kept[i]) el.classList.add('kept');
                
                // AI ì¶”ì²œ í‘œì‹œ
                if (aiRecommendation && aiRecommendation.dice_recommendations) {
                    const rec = aiRecommendation.dice_recommendations[i];
                    if (rec.action === 'keep') {
                        el.classList.add('ai-recommend-keep');
                    } else {
                        el.classList.add('ai-recommend-reroll');
                    }
                }
            });
            document.getElementById('rolls-left').innerText = rollsLeft;
            document.getElementById('roll-btn').disabled = rollsLeft <= 0 || gameOver;
        }
for (let i = 0; i < 5; i++) {
                if (!kept[i]) {
                    document.getElementById(`die-${i}`).classList.add('rolling');
                }
            }

            setTimeout(() => {
                // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
                for (let i = 0; i < 5; i++) {
                    if (!kept[i]) dice[i] = Math.floor(Math.random() * 6) + 1;
                }
                rollsLeft--;
                
                updateDiceUI();
                askAI();
            }, 6for (let i = 0; i < 5; i++) {
                    if (!kept[i]) dice[i] = Math.floor(Math.random() * 6) + 1;
                }
                rollsLeft--;
                
                document.querySelectorAll('.die').forEach(el => {
                    el.classList.remove('rolling');
                });
                
                updateDiceUI();
                askAI();
            }, 500);
        }

        async function askAI() {
            if (gameOver) return;
            
            const openCategories = scorecard
                .map((score, idx) => score === null ? idx : null)
                .filter(idx => idx !== null);
            
            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        dice: dice, 
                        rolls_left: rollsLeft, 
                        scorecard: scorecard 
                    })
                });
                const data = await response.json();
                aiRecommendation = data;
                
                document.getElementById('ai-message').innerText = "ğŸ¤– " + data.message;
                
                // ê° ì£¼ì‚¬ìœ„ë³„ ì¶”ì²œ í‘œì‹œ
                if (data.dice_recommendations) {
                    data.dice_recommendations.forEach((rec, i) => {
                        const recEl = document.getElementById(`rec-${i}`);
                        const action = rec.action === 'keep' ? 'âœ“ ìœ ì§€' : 'â†» ì¬êµ´ë¦¼';
                        recEl.innerText = `${action} (${rec.confidence}%)`;
                        recEl.style.color = rec.action === 'keep' ? '#00ff00' : '#ff4444';
                    });
                }
                
                updateDiceUI();
            } catch (e) {
                console.error('AI ì¶”ì²œ ì˜¤ë¥˜:', e);
                document.getElementById('ai-message').innerText = "âš ï¸ AI ì¶”ì²œì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            }
        }

        async function selectCategory(catIdx) {
            if (scorecard[catIdx] !== null || rollsLeft === 3 || gameOver) return;
            
            // ì ìˆ˜ ê³„ì‚° (ì„œë²„ì—ì„œ ê³„ì‚°)
            const score = calculateScore(dice, catIdx);
            scorecard[catIdx] = score;
            
            // ë‹¤ìŒ í„´ ì¤€ë¹„
            dice = [1, 1, 1, 1, 1];
            kept = [false, false, false, false, false];
            rollsLeft = 3;
            aiRecommendation = null;
            
            // ì¶”ì²œ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
            for (let i = 0; i < 5; i++) {
                document.getElementById(`rec-${i}`).innerText = '';
            }
            
            updateDiceUI();
            initScorecard();
            
            // ê²Œì„ ì¢…ë£Œ ì²´í¬
            if (scorecard.every(s => s !== null)) {
                gameOver = true;
                const total = calculateTotal();
                document.getElementById('ai-message').innerText = 
                    `ğŸ‰ ê²Œì„ ì¢…ë£Œ! ì´ì : ${total}ì `;
            } else {
                document.getElementById('ai-message').innerText = "ğŸ² ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ì£¼ì„¸ìš”!";
            }
        }

        function calculateScore(dice, catIdx) {
            const counts = {};
            dice.forEach(d => counts[d] = (counts[d] || 0) + 1);
            
            if (catIdx >= 0 && catIdx <= 5) {
                return (counts[catIdx + 1] || 0) * (catIdx + 1);
            }
            if (catIdx === 6) return dice.reduce((a, b) => a + b, 0);
            if (catIdx === 7) {
                const max = Math.max(...Object.values(counts));
                return max >= 4 ? dice.reduce((a, b) => a + b, 0) : 0;
            }
            if (catIdx === 8) {
                const vals = Object.values(counts).sort();
                if (vals.length === 1 || (vals.length === 2 && vals[0] === 2 && vals[1] === 3)) {
                    return dice.reduce((a, b) => a + b, 0);
                }
                return 0;
            }
            if (catIdx === 9) {
                const unique = [...new Set(dice)].sort();
                if ([1,2,3,4].every(d => unique.includes(d)) ||
                    [2,3,4,5].every(d => unique.includes(d)) ||
                    [3,4,5,6].every(d => unique.includes(d))) {
                    return 15;
                }
                return 0;
            }
            if (catIdx === 10) {
                const unique = [...new Set(dice)].sort();
                if ([1,2,3,4,5].every(d => unique.includes(d)) ||
                    [2,3,4,5,6].every(d => unique.includes(d))) {
                    return 30;
                }
                return 0;
            }
            if (catIdx === 11) {
                return Object.values(counts).includes(5) ? 50 : 0;
            }
            return 0;
        }

        function resetGame() {
            dice = [1, 1, 1, 1, 1];
            kept = [false, false, false, false, false];
            rollsLeft = 3;
            scorecard = Array(12).fill(null);
            gameOver = false;
         

        // ì´ˆê¸° 3D ì£¼ì‚¬ìœ„ ë Œë”ë§
        function initDice() {
            for (let i = 0; i < 5; i++) {
                const dieEl = document.getElementById(`die-${i}`);
                dieEl.innerHTML = create3DDie(dice[i], false);
                const inner = dieEl.querySelector('.die-3d');
                inner.onclick = () => toggleKeep(i);
                inner.setAttribute('data-index', i);
                inner.id = `die-${i}`;
            }
        }   aiRecommendation = null;
            
            for (let i = 0; i < 5; i++) {
                document.getElementById(`rec-${i}`).innerText = '';
            }
        initDice
            updateDiceUI();
            initScorecard();
            document.getElementById('ai-message').innerText = "ğŸ¤– ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!";
        }

        function rebootSystem() {
            if(confirm("ì •ë§ ì„œë²„ë¥¼ ì¬ë¶€íŒ…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                fetch('/reboot', {method: 'POST'});
                alert("ì¬ë¶€íŒ… ëª…ë ¹ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.");
            }
        }

        // ì´ˆê¸°í™”
        initScorecard();
        updateDiceUI();
    </script>
</body>
</html>